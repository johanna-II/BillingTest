# Pytest configuration for parallel test execution

[pytest]
# Base configuration for parallel testing
minversion = 8.0

# Parallel execution settings
addopts =
    -ra
    --strict-markers
    --cov=libs
    --cov-report=term-missing
    --cov-report=html:htmlcov-{env:PYTEST_XDIST_WORKER:master}
    --cov-report=xml:coverage-{env:PYTEST_XDIST_WORKER:master}.xml
    --junit-xml=report/junit-{env:PYTEST_XDIST_WORKER:master}.xml
    # Distribute tests by file to minimize conflicts
    --dist loadfile
    # Show local variables in tracebacks
    -l
    # Verbose output
    -v

# Test paths
testpaths = tests

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Parallel execution safety markers
markers =
    serial: marks tests that must run serially (not in parallel)
    mock_required: marks tests that require mock server to be running
    isolated: marks tests that need complete isolation from other tests

# Coverage settings for parallel execution
[coverage:run]
parallel = true
source = libs
omit =
    */tests/*
    */conftest.py
    libs/dependency_injection.py
    libs/observability/telemetry.py

[coverage:paths]
source =
    libs/
    */libs/

[coverage:report]
precision = 2
show_missing = true
skip_covered = false
fail_under = 80
